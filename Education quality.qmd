---
title: "Education quality"
author: "Daphné PERRY Justine CATTA Chloé MARQUIS Clémence HUANG"
execute:
  echo: false
format:
  wordcount-html:
    toc: true
    toc-depth: 3
    toc-location: left
    code-fold: true
  pdf:
    toc: true
editor: visual
---

1.  

    ```         
    What are the different high school quality indicators published by the ministry of higher education? [^sources1]
    ```
[^sources1]:
  https://www.education.gouv.fr/les-indicateurs-de-resultats-des-colleges-et-des-lycees-377729
  https://data.education.gouv.fr/explore/dataset/fr-en-indicateurs-de-resultat-des-lycees-gt_v2/ 


The French Ministry of Education, through the DEPP (Direction de l’évaluation, de la prospective et de la performance), publishes annually the *High School Value-Added Indicators* (Indicateurs de Valeur Ajoutée des Lycées, IVAL).\
Their objective is to assess high school performance while accounting for differences in student intake - rather than relying solely on raw outcome measures.

Three main **quality indicators** are published for general and technological high schools:

\underline{Baccalaureate success rate}

This indicator measures the proportion of students present at the baccalaureate examination who obtain the diploma: \[ \text{Success rate} = \frac{\text{Number of students who pass the bac}}{\text{Number of students present at the exam}} \]

\underline{Access rate to the baccalaureate}

The access rate represents the probability that a student entering a given high school in *seconde* will eventually obtain the baccalaureate in the same establishment, even if the student repeats a grade.\
It is computed as the product of successive transition probabilities: \[ \text{Access rate}\_{2nde \to bac} = (2nde \to 1ère) \times (1ère \to Terminale) \times (Terminale \to Bac) \]

\underline{Baccalaureate honors (mentions) rate}

This indicator measures the proportion of students present at the baccalaureate examination who obtain a mention (Assez Bien, Bien, or Très Bien (with or without Félicitations)).

For most indicators, results are published both **overall** and **by track or series** (general and technological streams such as STI2D, STMG, STL, ST2S, etc.).\
Each indicator is reported as an **observed value**, an **expected value**, and a **value-added measure**.

Administrative variables available in the datasets (UAI code, location, sector, student counts by grade) are descriptive and do not constitute quality indicators.


2.  

    ```         
    How is the value-added measure (IVAL, indicateur de valeur ajoutée), calculated?[^sources2]
    ```

[^sources2]: 
  https://catalogue.depp.education.fr/index.php/catalog/274 
  Franck Evain (Insee), *Indicateurs de valeur ajoutée des lycées*:  https://www.insee.fr/fr/information/5008703?sommaire=5008710 

The **value-added indicator** measures the contribution of a high school to student outcomes, net of external factors.\
It is defined as the difference between the observed rate and the expected rate:

\[ \text{Value-added} = \text{Observed rate} - \text{Expected rate} \]

The expected rate is the average rate of high schools with students that have identical characteristics. Therefore the IVAL evaluates the contribution due to the establishment, given initial students’ profiles. A positive value-added indicates that on average the high school allows students to perform better than expected given their initial profile, while a negative value-added indicates underperformance.

\underline{Estimation of expected rates}

Expected rates are estimated using **multilevel logistic regression models**, which are appropriate for binary outcomes (success or failure, mention or no mention) and account for the hierarchical structure of the data (students nested within schools).

The models include:

**Individual-level variables** - Age\
- Gender\
- Academic achievement at entry into high school (e.g. results at the Diplôme National du Brevet)\
- Social background, measured using the Social Position Index (IPS)

**School-level variables** - Proportion of students with academic delay\
- Proportion of girls\
- Average IPS of students\
- Average prior academic achievement within the school

For each student, the model produces an expected probability of success, access, or obtaining a mention, assuming enrollment in a statistically average high school (i.e. excluding the specific school effect).\
The expected rate of a high school is then computed as the average of its students’ expected probabilities.

In the case of access to the baccalaureate, separate models are estimated for each transition (seconde→première, première→terminale, terminale→bac), and the expected access rate is obtained by multiplying the expected transition probabilities.

3.  

    ```         
    How do the IVAL and other indicators correlate with IPS (indicateurs de position sociale, a higher IPS indicates the higher average socio-economic status of parents at the school level) in Paris? Can you propose a way to represent graphically the correlations, for High schools in Paris (separately for public and private high schools)?
    ```

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo    = TRUE,
  message = FALSE,
  warning = FALSE
)

rm(list = ls())
```

```{r}
library(vroom)
library(here)
library(ggplot2)
library(dplyr)
library(readxl)
library(tidyr)
library(stringr)
library(janitor)
here::i_am("quality_education.Rproj")

# Import datasets
quality_indicators <- vroom(here("data", "fr-en-indicateurs-de-resultat-des-lycees-gt_v2.csv")) |>
  clean_names()
ips <- vroom(here("data", "fr-en-ips_lycees.csv")) |>
  clean_names()
path_ival <- here("data", "ival-2024-154664.xlsx")
ival_lgt <- read_excel(path_ival, sheet = "LGT", skip = 1) |>
  clean_names()
ival_lp  <- read_excel(path_ival, sheet = "LP",  skip = 1) |>
  clean_names()
```

```{r}
# Data cleaning and merging

# Convert logical columns (mostly NA) to numeric
quality_indicators <- quality_indicators |>
  mutate(across(where(is.logical), ~ as.numeric(.)))

# Build year from school-year label (e.g., "2023-2024" -> 2023)
ips <- ips |>
  mutate(annee = as.integer(str_extract(rentree_scolaire, "\\d{4}")))

# Keep Paris (dept 75)
quality_paris <- quality_indicators |>
  filter(code_departement == "75")

ips_paris <- ips |>
  filter(code_du_departement == "75")

# Pick the most recent common year
years_common <- intersect(sort(unique(quality_paris$annee)), sort(unique(ips_paris$annee)))
if (length(years_common) == 0) stop("No common year in Paris (75).")
year_use <- max(years_common, na.rm = TRUE)

quality_paris_y <- quality_paris |>
  filter(annee == year_use)

ips_paris_y <- ips_paris |>
  filter(annee == year_use)

# Harmonize sector labels
quality_paris_y <- quality_paris_y |>
  mutate(
    secteur = case_when(
      str_detect(tolower(secteur), "public") ~ "Public",
      str_detect(tolower(secteur), "priv") ~ "Private",
      TRUE ~ as.character(secteur)
    )
  )

ips_paris_y <- ips_paris_y |>
  mutate(
    secteur = case_when(
      str_detect(tolower(secteur), "public") ~ "Public",
      str_detect(tolower(secteur), "priv") ~ "Private",
      TRUE ~ as.character(secteur)
    )
  )

# Merge (UAI + year + sector)
df_paris <- quality_paris_y |>
  left_join(
    ips_paris_y |>
      select(
        uai, annee, secteur,
        matches("^ips_"),
        matches("^ecart_type_de_l_ips")
      ),
    by = c("uai", "annee", "secteur")
  )

# Quick join check
df_paris |>
  summarise(
    n_qi = n(),
    n_ips_match = sum(!is.na(ips_ensemble_gt_pro)),
    pct_ips_match = mean(!is.na(ips_ensemble_gt_pro)) * 100
  ) |>
  print()
```


## graphical representations
### descriptive analyses

```{r}
ggplot(df_paris,
       aes(x = ips_ensemble_gt_pro, fill = secteur)) +
  geom_density(alpha = 0.4) +
  labs(
    x = "IPS",
    title = "IPS distribution : Private vs Public"
  )
```
The IPS distribution differs markedly across sectors. Public high schools include a substantial mass of establishments with IPS values between 90 and 110, a range that is absent among private schools. The public-sector distribution peaks around an IPS of approximately 130.

By contrast, private high schools are concentrated at much higher socio-economic levels. Their IPS values are mainly distributed between 120 and 160, with a clear peak around 145. This indicates a strong social selection into the private sector.

```{r}
ggplot(df_paris,
       aes(x = ecart_type_de_l_ips_voie_gt, fill = secteur)) +
  geom_density(alpha = 0.4) +
  labs(
    x = "IPS Standard deviation",
    title = "Intern social heterogeneity distribution"
  )
```
The within-school dispersion of IPS also differs across sectors. In private high schools, the density of the IPS standard deviation is flat and is mainly concentrated between 20 and 35.

In public high schools, the IPS standard deviation is both higher and less dispersed. It typically ranges from about 25 to above 40, with a strong density peak around 37–38. Most public schools lie between 32 and 42. This suggests substantially greater social heterogeneity within public establishments.

```{r}
# nuages de points 
# 1. avec taux de réussite / IPS (+ lm)
ggplot(df_paris,
       aes(x = ips_ensemble_gt_pro,
           y = taux_de_reussite_toutes_series)) +
  geom_point(alpha = 0.6) +
  geom_smooth(method = "lm", se = TRUE) +
  facet_wrap(~ secteur) +
  labs(
    x = "IPS",
    y = "Success rate",
    title = "IPS and Success rate"
  )
```
Private high schools display a large mass of success rates at 100%, and all private schools exceed 96%. There is no strong visible correlation between IPS and success rates within the private sector. However, as IPS increases, success rates are less likely to be below 100%.

In the public sector, a strong positive relationship between IPS and success rates is observed. Public schools with an IPS below 120 never reach a 100% success rate, and their outcomes are widely dispersed, typically between about 88% and 97–98%. As IPS approaches the 120–130 range, all schools exceed 95%. Above an IPS of 130, success rates are almost exclusively between 99% and 100%.

This pattern is consistent with strong socio-economic gradients in academic success within public high schools.

```{r}
# 2. avec le taux d'accès
ggplot(df_paris,
       aes(x = ips_ensemble_gt_pro,
           y = taux_dacces_terminale_bac)) +
  geom_point(alpha = 0.6) +
  facet_wrap(~ secteur) +
  labs(
    x = "IPS",
    y = "Rate of access to the final year (Terminale)",
    title = "IPS and Rate of access to the final year"
  )
```
In private high schools, the rate of access to terminale generally lies between 96% and 100% and does not appear strongly correlated with IPS. However, two private establishments around an IPS of 120 display much lower retention rates (around 70%). This may reflect selective retention practices (e.g. exclusion or strategic orientation), suggesting particularly strong selection mechanisms in some private schools.

In public high schools, the relationship with IPS is again pronounced. Below an IPS of 120, no school reaches a 100% access rate, and variance is higher, with some schools around 90% and others closer to 96–98%. Above an IPS of 120, 100% access rates begin to appear and dispersion decreases, with most schools between 97% and 100%. Above an IPS of 130, access rates are almost entirely between 98% and 100%.

This likely reflects socio-economic differences in educational trajectories: higher-IPS families are more likely to maintain academic tracks through to terminale, while lower-IPS public schools may experience more reorientation toward vocational pathways.

```{r}
# 3. avec valeur ajoutée du taux de réussite
ggplot(df_paris,
       aes(x = ips_ensemble_gt_pro,
           y = valeur_ajoutee_du_taux_de_reussite_toutes_series,
           size = effectif_de_terminale)) +
  geom_point(alpha = 0.5) +
  facet_wrap(~ secteur) +
  labs(
    x = "IPS",
    y = "added value of the Success rate",
    size = "Number of students in final year",
    title = "IPS, VA and highschool size"
  )


```
In private high schools, below an IPS of 130, only one establishment shows a negative value added (around −1), while all others are positive. Most private schools are around +1, and several reach values between +2 and +4, suggesting positive contributions to student outcomes.

Above an IPS of 130, value added becomes tightly concentrated around zero. This is mechanically consistent with the construction of the indicator: with very high IPS, expected success rates are already extremely high, so realized outcomes (100% success rate) tend to match expectations, resulting in near-zero value added. Large positive value added becomes rare, and most schools are at 0, +1, or occasionally −1.

Public high schools are much more heterogeneous once again. Below an IPS of 120, few schools are at zero value added. Two schools reach very high positive values of +7, while several are strongly negative (around −4 or −5), and most lie between −2 and +2. Above an IPS of 120, and again partly by construction, value added becomes more concentrated around zero, with most schools between −1, 0, and +1.

This highlights substantially greater heterogeneity in public-school performance relative to expectations.
```{r}
# densité

ggplot(df_paris,
       aes(x = valeur_ajoutee_du_taux_de_reussite_toutes_series,
           fill = secteur)) +
  geom_density(alpha = 0.4) +
  geom_vline(xintercept = 0, linetype = "dashed") +
  labs(
    x = "Added value of the Success rate",
    title = "distribution of the added value of the Success rate: Private vs Public"
  )
```
The density plot of value added confirms these patterns. For strongly negative values (below −1), there are no private high schools, whereas several public high schools fall in this range. Both sectors display a peak around zero.

For public high schools, the right tail of the distribution extends up to about +3. 
In contrast, private high schools exhibit a second peak around +1. The deviation of the private-sector distribution is much narrower, largely concentrated between −1 and +1, while the public-sector distribution is slightly more spread out and extends further to the left.

Overall, this indicates that negative value added is primarily a public-sector phenomenon in this sample, and that performance relative to expectations is more tightly concentrated in the private sector.





